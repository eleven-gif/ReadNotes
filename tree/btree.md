# B树及变种
## 平衡二叉树

B树首先是一个平衡树。
平衡二叉树，保证左子节点小于跟节点小于右子节点，并保证左右子树高度差距不会大于1，从而使查找速度接近二分查找。

调节节点使树平衡的算法有Treap(树堆)以及红黑树等。

## B树
简单来说，平衡二叉树的叉多一点，就是个B树了，关键字依旧是左小右大，平衡多路查找树。
M路B树，非叶子节点子节点数大于1小于等于M，非叶子节点关键字数量大于等于ceil(m/2)-1小于等于m-1。ceil向上取整。

所有叶子节点在同一层，所有节点都会保存索引关键字，以及关键字指向的记录。

修改时会涉及到节点的分裂与合并。

分裂时，分裂点上升到父节点，新数据以及原分裂点右边的数据作为分裂点的右子树。

合并时，父节点右边第一个下降到子节点填充，然后下降节点的右边子树第一个节点上升为父节点。

### 特点
B树相对于平衡二叉树，每个节点包含的关键字增多了，B树在数据库中，数据库充分利用了磁盘块的原理（磁盘数据存储是采用块的形式存储的，每个块的大小为4K，每次IO进行数据读取时，同一个磁盘块的数据可以一次性读取出来）把节点大小限制和充分使用在磁盘快大小范围；把树的节点关键字增多后树的层级比原来的二叉树少了，减少数据查找的次数和复杂度;

## B+树
B树升级版，更充分利用节点空间，查找速度完全接近二分查找，所以效率更高。

B+树非叶子节点不保存关键字记录的指针，只进行数据索引，所以非叶子节点能保存更多的关键字。

叶子节点保存了父节点所有关键字记录的指针，必须到叶子节点才能拿到地址，所以查询次数固定。

叶子节点关键字有序，左边的叶子节点数据结尾会保存右边节点数据的开始指针。

非叶子节点数=关键字数；或者非叶子节点的关键字数=子节点数-1，只是数据结构排列不同(mysql使用第一种)。

    注：第一种实际就是关键字指向数据，第二种是关键字两边指向数据

### 特点
- 非叶子节点存储关键字更多，所以层数更少，超找过快
- 查找次数稳定，因为每次都要走到底
- 叶子节点数据构成有序链表，区间查询更方便，数据紧密性高，缓存命中率更高。
- 全节点遍历更快，遍历链表即可，有利于数据库全表扫描
- B树的优点为，如果常访问的数据离根节点近，那么B树更快，因为非叶子节点也有数据，而B+树每次都要走到底

## B*树
B+树的变种，有两个不同点
- 不按键子个数限制不同，b+树关键词初始化个数为ceil(m/2)，b\*树为ceil(2/3*m)
- b+树节点满时会分裂(类似于b树)，b\*树节点满时会检查兄弟节点(每个节点保存兄弟节点指针)，如果兄弟节点没满则向兄弟节点转移关键字，如果满了，则从当前节点以及兄弟节点都拿出1/3的数据成立新节点。

优点：
- 比b+树分裂次数更少